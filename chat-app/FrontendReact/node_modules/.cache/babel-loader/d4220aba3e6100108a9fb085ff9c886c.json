{"ast":null,"code":"import _regeneratorRuntime from\"/home/serafym/\\u041E\\u0431\\u0449\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435/development/ChatApp/chat-app/FrontendReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/home/serafym/\\u041E\\u0431\\u0449\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435/development/ChatApp/chat-app/FrontendReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/home/serafym/\\u041E\\u0431\\u0449\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435/development/ChatApp/chat-app/FrontendReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/serafym/\\u041E\\u0431\\u0449\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435/development/ChatApp/chat-app/FrontendReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/serafym/\\u041E\\u0431\\u0449\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435/development/ChatApp/chat-app/FrontendReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/serafym/\\u041E\\u0431\\u0449\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435/development/ChatApp/chat-app/FrontendReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/serafym/\\u041E\\u0431\\u0449\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435/development/ChatApp/chat-app/FrontendReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _defineProperty from\"/home/serafym/\\u041E\\u0431\\u0449\\u0435\\u0434\\u043E\\u0441\\u0442\\u0443\\u043F\\u043D\\u044B\\u0435/development/ChatApp/chat-app/FrontendReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";var _styled;import React,{Component}from\"react\";import ChatService from\"../../services/chat.service\";import InputMessageForm from\"./inputMessage\";import MessageContainer from\"./messageContainer\";import UsersList from\"./usersContainer\";import io from\"socket.io-client\";import*as actions from\"../../redux/actions/chatActions/chat.actions\";import*as authActions from\"../../redux/actions/authActions/auth.actions\";import{connect}from\"react-redux\";import moment from\"moment\";import jwt from\"jwt-decode\";import{Container}from\"@material-ui/core\";import{styled}from\"@material-ui/core/styles\";import Header from\"./chatHeader\";import Box from\"@material-ui/core/Box\";var ChatContainer=styled(Container)((_styled={background:\"#6d81af\",display:\"flex\",flexDirection:\"row-reverse\",margin:0,padding:0,height:815,position:'relative',maxHeight:1000},_defineProperty(_styled,\"@media (max-height:900px)\",{// eslint-disable-line no-useless-computed-key\nheight:715,maxHeight:900}),_defineProperty(_styled,\"@media (max-height:800px)\",{// eslint-disable-line no-useless-computed-key\nheight:615,maxHeight:800}),_defineProperty(_styled,\"@media (max-height:700px)\",{// eslint-disable-line no-useless-computed-key\nheight:515,maxHeight:700}),_defineProperty(_styled,\"@media (max-height:600px)\",{// eslint-disable-line no-useless-computed-key\nheight:415,maxHeight:600}),_defineProperty(_styled,\"@media (max-height:500px)\",{// eslint-disable-line no-useless-computed-key\nheight:315,maxHeight:500}),_defineProperty(_styled,\"@media (max-height:400px)\",{// eslint-disable-line no-useless-computed-key\nheight:250,maxHeight:400}),_styled));var ChatPage=/*#__PURE__*/function(_Component){_inherits(ChatPage,_Component);var _super=_createSuper(ChatPage);function ChatPage(props){var _this;_classCallCheck(this,ChatPage);_this=_super.call(this,props);_this.colorNickName=\"white\";_this.handleNewUserMessage=function(newMessage){console.log(\"New message incomig! \".concat(newMessage));// Now send the message throught the backend API\n};_this.state={messages:[],isAdmin:false,currentUser:\"\",isMuted:false,showUsersContainer:true,usersListMobile:false};return _this;}_createClass(ChatPage,[{key:\"UNSAFE_componentWillMount\",value:function UNSAFE_componentWillMount(){debugger;}},{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this2=this;var token,handler,decodedUser;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return localStorage.getItem(\"userToken\");case 2:token=_context.sent;if(token){_context.next=6;break;}this.props.history.push(\"/login\");return _context.abrupt(\"return\");case 6:handler=function handler(e){_this2.setState({usersListMobile:e.matches});if(e.matches){_this2.setState({showUsersContainer:false});}};window.matchMedia(\"(max-width: 400px)\").addListener(handler);_context.next=10;return this.props.initConnection();case 10:// this.props.socket.on(\"users\", (res) => dispatch(AllUsers(res)));\nthis.props.socket.on(\"onlineUsers\",function(res){return _this2.props.setOnlineUsers(res);});this.props.socket.on(\"users\",function(res){_this2.props.setOnlineUsers(res);});this.props.socket.on(\"previousMessages\",function(res){return _this2.setState({messages:res});});this.props.socket.on(\"initialMuteStatus\",function(IsMute){return _this2.props.setIsMuteStatus(IsMute);});this.props.socket.on(\"mute\",function(IsMute){debugger;console.log(IsMute);_this2.props.setIsMuteStatus(IsMute);_this2.setState({isMuted:IsMute});});this.props.socket.on(\"chat\",function(res){return _this2.setState({messages:[].concat(_toConsumableArray(_this2.state.messages),[res])});});this.props.socket.on(\"connection\",function(socket){_this2.props.socket.on(\"disconnect\",function(reason){localStorage.removeItem(\"userToken\");_this2.props.history.push(\"/login\");});});this.props.socket.on(\"disconnect\",function(socket){localStorage.removeItem(\"userToken\");_this2.props.history.push(\"/login\");});this.props.socket.on(\"disconnected\",function(reason){});decodedUser=jwt(token);this.colorNickName=decodedUser.nickNameColor;this.setState({isAdmin:decodedUser.isAdmin,currentUser:decodedUser.nickName});// this.props.socket.emit(\"onlineUsers\", token);\nthis.props.isConnected(true);case 23:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"setMuteStatus\",value:function(){var _setMuteStatus=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(user){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.props.socket.emit(\"mute\",user.id);case 1:case\"end\":return _context2.stop();}}},_callee2,this);}));function setMuteStatus(_x){return _setMuteStatus.apply(this,arguments);}return setMuteStatus;}()},{key:\"setBan\",value:function(){var _setBan=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(user){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:this.props.socket.emit(\"ban\",user.id);case 1:case\"end\":return _context3.stop();}}},_callee3,this);}));function setBan(_x2){return _setBan.apply(this,arguments);}return setBan;}()},{key:\"sendMsg\",value:function(){var _sendMsg=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(message){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.setState({messages:[].concat(_toConsumableArray(this.state.messages),[message])});this.props.socket.emit(\"chat\",JSON.stringify(message));case 2:case\"end\":return _context4.stop();}}},_callee4,this);}));function sendMsg(_x3){return _sendMsg.apply(this,arguments);}return sendMsg;}()},{key:\"logout\",value:function(){var _logout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return localStorage.removeItem(\"userToken\");case 2:this.props.socket.disconnect(true);this.props.history.push(\"/login\");case 4:case\"end\":return _context5.stop();}}},_callee5,this);}));function logout(){return _logout.apply(this,arguments);}return logout;}()},{key:\"render\",value:function render(){var _this3=this;var _this$props=this.props,isConnected=_this$props.isConnected,onlineUsers=_this$props.onlineUsers;var _this$state=this.state,isAdmin=_this$state.isAdmin,currentUser=_this$state.currentUser,showUsersContainer=_this$state.showUsersContainer,usersListMobile=_this$state.usersListMobile;return/*#__PURE__*/React.createElement(Container,{style:{display:\"flex\",flexDirection:\"column\"}},/*#__PURE__*/React.createElement(Header,{username:currentUser,colorNickName:this.colorNickName,showHideUsersList:function showHideUsersList(){return _this3.setState({showUsersContainer:!_this3.state.showUsersContainer});},logout:function logout(){return _this3.logout();}}),/*#__PURE__*/React.createElement(ChatContainer,null,/*#__PURE__*/React.createElement(UsersList,{users:onlineUsers,isAdmin:isAdmin,userName:currentUser,setMuteStatus:function setMuteStatus(user){return _this3.setMuteStatus(user);},setBan:function setBan(user){return _this3.setBan(user);},showUsersContainer:showUsersContainer,usersListMobile:usersListMobile}),/*#__PURE__*/React.createElement(MessageContainer,{messages:this.state.messages,username:this.state.currentUser,colorNickName:this.colorNickName})),!this.state.isMuted?/*#__PURE__*/React.createElement(InputMessageForm,{handleSubmit:function handleSubmit(message){return _this3.sendMsg(message);}}):null);// isConnected && onlineUsers.length > 0 ?\n//  : null;\n}}]);return ChatPage;}(Component);function mapStateToProps(state){return{isConnected:state.chatReducer.isConnected,onlineUsers:state.chatReducer.onlineUsers,messages:state.chatReducer.messages,socket:state.chatReducer.socket,isMuted:state.chatReducer.isMuted};}function mapDispatchToProps(dispatch){return{initConnection:function initConnection(){return dispatch(actions.initWebSocketConnection(dispatch));},setOnlineUsers:function setOnlineUsers(onlineUsers){return dispatch(actions.allOnlineUsers(onlineUsers));},isConnected:function isConnected(status){return dispatch(actions.isConnected(status));},setIsMuteStatus:function setIsMuteStatus(status){return dispatch(actions.setIsMuteStatus(status));},setIsLoggedIn:function setIsLoggedIn(status){return dispatch(authActions.isSignedInUser(status));}};}export default connect(mapStateToProps,mapDispatchToProps)(ChatPage);","map":{"version":3,"sources":["/home/serafym/Общедоступные/development/ChatApp/chat-app/FrontendReact/src/components/chatPage/chat.jsx"],"names":["React","Component","ChatService","InputMessageForm","MessageContainer","UsersList","io","actions","authActions","connect","moment","jwt","Container","styled","Header","Box","ChatContainer","background","display","flexDirection","margin","padding","height","position","maxHeight","ChatPage","props","colorNickName","handleNewUserMessage","newMessage","console","log","state","messages","isAdmin","currentUser","isMuted","showUsersContainer","usersListMobile","localStorage","getItem","token","history","push","handler","e","setState","matches","window","matchMedia","addListener","initConnection","socket","on","res","setOnlineUsers","IsMute","setIsMuteStatus","reason","removeItem","decodedUser","nickNameColor","nickName","isConnected","user","emit","id","message","JSON","stringify","disconnect","onlineUsers","logout","setMuteStatus","setBan","sendMsg","mapStateToProps","chatReducer","mapDispatchToProps","dispatch","initWebSocketConnection","allOnlineUsers","status","setIsLoggedIn","isSignedInUser"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport ChatService from \"../../services/chat.service\";\nimport InputMessageForm from \"./inputMessage\";\nimport MessageContainer from \"./messageContainer\";\nimport UsersList from \"./usersContainer\";\nimport io from \"socket.io-client\";\nimport * as actions from \"../../redux/actions/chatActions/chat.actions\";\nimport * as authActions from \"../../redux/actions/authActions/auth.actions\";\nimport { connect } from \"react-redux\";\nimport moment from \"moment\";\nimport jwt from \"jwt-decode\";\nimport { Container } from \"@material-ui/core\";\nimport { styled } from \"@material-ui/core/styles\";\nimport Header from \"./chatHeader\";\nimport Box from \"@material-ui/core/Box\";\n\nconst ChatContainer = styled(Container)({\n  background: \"#6d81af\",\n  display: \"flex\",\n  flexDirection: \"row-reverse\",\n  margin: 0,\n  padding: 0,\n  height: 815,\n  position: 'relative',\n  maxHeight: 1000,\n  [\"@media (max-height:900px)\"]: {\n    // eslint-disable-line no-useless-computed-key\n    height: 715,\n    maxHeight: 900,\n  },\n  [\"@media (max-height:800px)\"]: {\n    // eslint-disable-line no-useless-computed-key\n    height: 615,\n    maxHeight: 800,\n  },\n  [\"@media (max-height:700px)\"]: {\n    // eslint-disable-line no-useless-computed-key\n    height: 515,\n    maxHeight: 700,\n  },\n  [\"@media (max-height:600px)\"]: {\n    // eslint-disable-line no-useless-computed-key\n    height: 415,\n    maxHeight: 600,\n  },\n  [\"@media (max-height:500px)\"]: {\n    // eslint-disable-line no-useless-computed-key\n    height: 315,\n    maxHeight: 500,\n  },\n  [\"@media (max-height:400px)\"]: {\n    // eslint-disable-line no-useless-computed-key\n    height: 250,\n    maxHeight: 400,\n  },\n});\n\nclass ChatPage extends Component {\n  colorNickName = \"white\";\n  constructor(props) {\n    super(props);\n    this.state = {\n      messages: [],\n      isAdmin: false,\n      currentUser: \"\",\n      isMuted: false,\n      showUsersContainer: true,\n      usersListMobile: false\n    };\n  }\n  UNSAFE_componentWillMount() {\n    debugger;\n  }\n\n\n  async componentDidMount() {\n    let token = await localStorage.getItem(\"userToken\");\n    if (!token) {\n      this.props.history.push(\"/login\");\n      return;\n    }\n\n    const handler = e => { this.setState({usersListMobile: e.matches}); if(e.matches) {\n      this.setState({showUsersContainer: false});\n    }};\n    window.matchMedia(\"(max-width: 400px)\").addListener(handler);\n    await this.props.initConnection();\n    // this.props.socket.on(\"users\", (res) => dispatch(AllUsers(res)));\n    this.props.socket.on(\"onlineUsers\", (res) =>\n      this.props.setOnlineUsers(res)\n    );\n    this.props.socket.on(\"users\", (res) => {\n      this.props.setOnlineUsers(res);\n    });\n    this.props.socket.on(\"previousMessages\", (res) =>\n      this.setState({\n        messages: res,\n      })\n    );\n    this.props.socket.on(\"initialMuteStatus\", (IsMute) =>\n      this.props.setIsMuteStatus(IsMute)\n    );\n    this.props.socket.on(\"mute\", (IsMute) => {\n      debugger;\n      console.log(IsMute);\n      this.props.setIsMuteStatus(IsMute);\n      this.setState({ isMuted: IsMute });\n    });\n    this.props.socket.on(\"chat\", (res) =>\n      this.setState({\n        messages: [...this.state.messages, res],\n      })\n    );\n\n    this.props.socket.on(\"connection\", (socket) => {\n      this.props.socket.on(\"disconnect\", (reason) => {\n        localStorage.removeItem(\"userToken\");\n        this.props.history.push(\"/login\");\n      });\n    });\n\n    this.props.socket.on(\"disconnect\", (socket) => {\n      localStorage.removeItem(\"userToken\");\n      this.props.history.push(\"/login\");\n    });\n    this.props.socket.on(\"disconnected\", (reason) => {});\n    const decodedUser = jwt(token);\n    this.colorNickName = decodedUser.nickNameColor;\n    this.setState({\n      isAdmin: decodedUser.isAdmin,\n      currentUser: decodedUser.nickName,\n    });\n    // this.props.socket.emit(\"onlineUsers\", token);\n\n    this.props.isConnected(true);\n  }\n\n  async setMuteStatus(user) {\n    this.props.socket.emit(\"mute\", user.id);\n  }\n\n  async setBan(user) {\n    this.props.socket.emit(\"ban\", user.id);\n  }\n  handleNewUserMessage = (newMessage) => {\n    console.log(`New message incomig! ${newMessage}`);\n    // Now send the message throught the backend API\n  };\n\n  async sendMsg(message) {\n    this.setState({\n      messages: [...this.state.messages, message],\n    });\n    this.props.socket.emit(\"chat\", JSON.stringify(message));\n  }\n\n  async logout() {\n    await localStorage.removeItem(\"userToken\");\n    this.props.socket.disconnect(true);\n    this.props.history.push(\"/login\");\n  }\n\n  render() {\n    const { isConnected, onlineUsers } = this.props;\n\n    const { isAdmin, currentUser, showUsersContainer, usersListMobile} = this.state;\n\n    return (\n      <Container style={{ display: \"flex\", flexDirection: \"column\" }}>\n        <Header\n          username={currentUser}\n          colorNickName={this.colorNickName}\n          showHideUsersList={() =>\n            this.setState({\n              showUsersContainer: !this.state.showUsersContainer,\n            })\n          }\n          logout={() => this.logout()}\n        />\n        <ChatContainer>\n          <UsersList\n            users={onlineUsers}\n            isAdmin={isAdmin}\n            userName={currentUser}\n            setMuteStatus={(user) => this.setMuteStatus(user)}\n            setBan={(user) => this.setBan(user)}\n            showUsersContainer={showUsersContainer}\n            usersListMobile = {usersListMobile}\n          />\n          <MessageContainer\n            messages={this.state.messages}\n            username={this.state.currentUser}\n            colorNickName={this.colorNickName}\n          />\n        </ChatContainer>\n        {!this.state.isMuted ? (\n          <InputMessageForm handleSubmit={(message) => this.sendMsg(message)} />\n        ) : null}\n      </Container>\n    );\n    // isConnected && onlineUsers.length > 0 ?\n\n    //  : null;\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    isConnected: state.chatReducer.isConnected,\n    onlineUsers: state.chatReducer.onlineUsers,\n    messages: state.chatReducer.messages,\n    socket: state.chatReducer.socket,\n    isMuted: state.chatReducer.isMuted,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    initConnection: () => dispatch(actions.initWebSocketConnection(dispatch)),\n    setOnlineUsers: (onlineUsers) =>\n      dispatch(actions.allOnlineUsers(onlineUsers)),\n    isConnected: (status) => dispatch(actions.isConnected(status)),\n    setIsMuteStatus: (status) => dispatch(actions.setIsMuteStatus(status)),\n    setIsLoggedIn: (status) => dispatch(authActions.isSignedInUser(status)),\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ChatPage);\n"]},"metadata":{},"sourceType":"module"}