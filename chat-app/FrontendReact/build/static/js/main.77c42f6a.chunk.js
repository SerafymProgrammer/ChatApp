(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{178:function(e,t,n){e.exports=n(276)},183:function(e,t,n){},272:function(e,t){},276:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(10),i=n.n(o),c=(n(183),n(11)),s=n(43),u=n(150),l=n(13),m={users:[],isConnected:!1,socket:null,messages:[],focusRoom:"default",rooms:[]};var d={isLoggedIn:!1,allUsers:[],isConnected:!1,isFetching:!1};var f=Object(s.c)({chatReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"USERS":return Object(l.a)(Object(l.a)({},e),{},{users:t.users});case"ROOMS":return Object(l.a)(Object(l.a)({},e),{},{rooms:t.rooms});case"IS_CONNECTED":return Object(l.a)(Object(l.a)({},e),{},{isConnected:t.isConnected});case"SET_SOCKET":return Object(l.a)(Object(l.a)({},e),{},{socket:t.socket});case"FOCUS_ROOM":return Object(l.a)(Object(l.a)({},e),{},{roomName:t.focusRoom});case"ALL_MESSAGES":return Object(l.a)(Object(l.a)({},e),{},{messages:t.messages});default:return e}},authReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IS_LOGGED_IN":return Object(l.a)(Object(l.a)({},e),{},{isLoggedIn:t.isLoggedIn});case"IS_FETCHING":return Object(l.a)(Object(l.a)({},e),{},{isFetching:t.isFetching});default:return e}}}),g=Object(s.d)(f,Object(s.a)(u.a)),b=n(42),h=n(325),p=n(157),O=n.n(p),E=n(90),j=n(281),v=n(19),k=n(311),x=n(33),y=function(e){var t=Object(a.useState)(e),n=Object(x.a)(t,2),r=n[0],o=n[1];return{value:r,setValue:o,reset:function(){return o("")},bind:{value:r,onChange:function(e){o(e.target.value)}}}},C=function(e){var t=e.isFetching,n=e.handleSubmit,o=y(""),i=o.value,c=o.bind,s=(o.reset,y("")),u=s.value,l=s.bind;s.reset;Object(a.useEffect)((function(){return v.ValidatorForm.addValidationRule("moreThanThreeChar",(function(e){return e.length>3})),v.ValidatorForm.addValidationRule("notAllowedSpecialSymbols",(function(e){return!/[^A-z\u0410-\u044f\u0401\u04510-9]/.test(e)})),function(){v.ValidatorForm.removeValidationRule("moreThanThreeChar"),v.ValidatorForm.removeValidationRule("moreThanThreeChar")}}),[v.ValidatorForm]);var m=Object(a.useCallback)((function(e){e.preventDefault(),n({username:i,password:u})}),[i,u,n]);return r.a.createElement(v.ValidatorForm,{onSubmit:m},r.a.createElement(v.TextValidator,Object.assign({fullWidth:!0,label:"Username",name:"username"},c,{validators:["required","moreThanThreeChar","notAllowedSpecialSymbols"],errorMessages:["this field is required","3 characters minimum","Not allowed special symbols"],margin:"normal"})),r.a.createElement(v.TextValidator,Object.assign({fullWidth:!0,label:"Password",type:"password"},l,{name:"password",validators:["required"],errorMessages:["this field is required"],margin:"normal"})),r.a.createElement(j.a,{variant:"contained",fullWidth:!0,color:"primary",type:"submit",disabled:t,margin:"normal"},t&&r.a.createElement(k.a,{size:20})," Sign In"))},w=n(58),S=n.n(w),N=n(87),R=n(37),M=n(155),T=n.n(M),I=function e(){Object(R.a)(this,e)};I.loginUser=function(e){return T.a.post("".concat("http://localhost:3000","/auth/login"),e)};var F=n(59),V=n.n(F),L=function(e){return{type:"IS_FETCHING",isFetching:e}},U=function(e){return{type:"IS_LOGGED_IN",isLoggedIn:e}};var W=n(27),A=n(280),H=n(156),_=n.n(H)()((function(e){return{main:Object(W.a)({width:"auto",display:"block",marginLeft:3*e.spacing.unit,marginRight:3*e.spacing.unit},e.breakpoints.up(400+3*e.spacing.unit*2),{width:400,marginLeft:"auto",marginRight:"auto"}),paper:{marginTop:8*e.spacing.unit,display:"flex",flexDirection:"column",alignItems:"center",padding:"".concat(2*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px")},avatar:{margin:e.spacing.unit},text:{textAlign:"center"}}}))((function(e){var t=e.classes,n=e.children;return r.a.createElement("div",null,r.a.createElement("main",{className:t.main},r.a.createElement(A.a,{className:t.paper},n)))})),B=function(e){var t=Object(c.c)(),n=Object(a.useCallback)((function(e){return t(function(e){return function(){var t=Object(N.a)(S.a.mark((function t(n){return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(L(!0));case 2:return t.next=4,I.loginUser(e).then((function(e){var t=e.data,a=t.token,r=t.isAdmin,o=t.nickNameColor,i=t.nickName;V.a.set("token",a),V.a.set("userData",{isAdmin:r,nickName:i,nickNameColor:o}),n(L(!1)),n(U(!0))})).catch((function(e){alert(e.response.data),n(L(!1))}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(e))}),[t]),o=Object(c.d)((function(e){return e.authReducer.isFetching})),i=Object(c.d)((function(e){return e.authReducer.isLoggedIn}));Object(a.useEffect)((function(){i&&e.history.push("/chat")}),[i]);return r.a.createElement(_,null,r.a.createElement(h.a,null,r.a.createElement(O.a,null)),r.a.createElement(E.a,{component:"h1",variant:"h5"},"Sign in"),r.a.createElement(C,{handleSubmit:function(e){return function(e){var t=e.username,a=e.password;n({nickName:t,password:a}).catch((function(e){alert(e.message)}))}(e)},isFetching:o}))},D=n(165),G=n(313),P=n(158),q=n.n(P),z=n(312),J=Object(z.a)((function(e){return{inputMsg:Object(W.a)({width:"50%"},e.breakpoints.down("xs"),{width:"100%"}),formMsg:{display:"flex"}}})),K=function(e){var t=J(),n=y(""),o=n.value,i=n.bind,c=n.reset;Object(a.useEffect)((function(){return v.ValidatorForm.addValidationRule("maxSymbols",(function(e){return e.length<200})),function(){v.ValidatorForm.removeValidationRule("maxSymbols")}}),[v.ValidatorForm]);var s=Object(a.useCallback)((function(){var t=o;c(),e.handleSubmit(t)}));return r.a.createElement(v.ValidatorForm,{onSubmit:s,className:t.form},r.a.createElement(v.TextValidator,Object.assign({fullWidth:!0,label:"Message"},i,{name:"message",validators:["required","maxSymbols"],errorMessages:["this field is required","maximum 200 symbols"],margin:"normal",className:t.inputMsg})),r.a.createElement(G.a,{"aria-label":"send",type:"submit"},r.a.createElement(q.a,null)))},Y=n(315),$=n(314),Q=Object(z.a)((function(e){return{root:{display:"flex",marginTop:5,justifyContent:"flex-start"},myMsg:{display:"flex",marginTop:5,justifyContent:"flex-end"},rootPaper:{padding:e.spacing(1),maxWidth:200,borderRadius:20,backgroundColor:"#eaeaea"},myMsgPaper:{padding:e.spacing(1),maxWidth:200,borderRadius:20,backgroundColor:"#c1e2ce"},msgText:{margin:"auto",display:"block",maxHeight:"100%"}}}));function X(e){var t=e.timeMessage,n=e.authorMessage,a=e.textMessage,o=e.username,i=e.colorNickName,c=Q(o===n?"flex-end":"flex-start");return r.a.createElement("div",{className:o===n?c.myMsg:c.root},r.a.createElement(A.a,{className:o===n?c.myMsgPaper:c.rootPaper},r.a.createElement($.a,{item:!0,xs:!0,container:!0,direction:"column",className:o===n?c.myMsgPaper:c.rootPaper},r.a.createElement($.a,{item:!0,xs:!0},r.a.createElement(E.a,{variant:"subtitle2",style:{color:i}},n)),r.a.createElement($.a,{item:!0,xs:!0},r.a.createElement(E.a,{variant:"body1",style:{wordWrap:"break-word"}},a)),r.a.createElement($.a,{item:!0,xs:!0},r.a.createElement(E.a,{variant:"body2",color:"textSecondary"},t)))))}var Z=n(159),ee=n.n(Z),te=Object(z.a)((function(e){return{messagesContainer:{background:"inherit",display:"flex",flexDirection:"column",overflowY:"scroll",height:"inherit",maxHeight:"inherit",paddingBottom:10}}})),ne=function(e){var t=e.messages,n=e.username,o=Object(a.useRef)(null),i=te();return console.log(t),Object(a.useEffect)((function(){o.current.scrollTop=o.current.scrollHeight}),[t,o]),r.a.createElement(Y.a,{className:i.messagesContainer,ref:o},t.map((function(e,t){return r.a.createElement(X,{key:"key-msg-".concat(t),timeMessage:ee()(e.timeMessage).calendar(),authorMessage:e.authorMessage,textMessage:e.textMessage,username:n,colorNickName:e.colorAuthorName})})))},ae=n(310),re=n(317),oe=n(318),ie=n(316),ce=n(319),se=Object(z.a)((function(e){return{root:Object(W.a)({width:"100%",maxWidth:360,position:"relative",height:"avalaible",maxHeight:"inherit",borderColor:"#000",borderWidth:2,backgroundColor:"#eabf7d8c",top:0,left:0},e.breakpoints.down("xs"),{position:"absolute",backgroundColor:"#8cd2b5",height:300,overflowY:"scroll"}),ul:{backgroundColor:"#eabf7d8c",padding:0}}})),ue=function(e){var t=e.isAdmin,n=e.users,a=e.userName,o=e.setMuteStatus,i=e.setBan,c=e.showUsersContainer,s=e.goToOneToOneRoome,u=se(),l={Online:n.filter((function(e){return e.onlineStatus})),Offline:n.filter((function(e){return!e.onlineStatus}))},m=t?["Online","Offline"]:["Online"];return r.a.createElement(ae.a,{className:u.root,subheader:r.a.createElement("li",null),style:c?{display:"block"}:{display:"none"}},m.map((function(e,n){return r.a.createElement("li",{key:"section-".concat(n),className:u.listSection},r.a.createElement("ul",{className:u.ul},r.a.createElement(ie.a,null,"".concat(e)),l[e].map((function(e){return r.a.createElement(re.a,{key:"".concat(e.nickName)},r.a.createElement(oe.a,{primary:"".concat(e.nickName),style:{color:e.nickNameColor}}),r.a.createElement(j.a,{onClick:function(){return t=e.userId,void s(t);var t}}," 1to1"),t&&e.nickName!==a?r.a.createElement(ce.a,{size:"small","aria-label":"small outlined button group"},r.a.createElement(j.a,{onClick:function(){return t=e.userId,void o(t);var t}}," ",e.isMuted?"unmute":"mute"),r.a.createElement(j.a,{onClick:function(){return t=e.userId,void i(t);var t}},e.isBaned?"unban":"ban")):null)}))))})))},le=n(54),me=n(160),de=n.n(me),fe=function(){function e(t){if(Object(R.a)(this,e),e.exists)return e.instance;e.instance=this,e.exists=!0,this.socket=de()("".concat("http://localhost:3000","?token=").concat(t),{forceNew:!0})}return Object(le.a)(e,[{key:"getSocket",value:function(){return this.socket}}],[{key:"changeExists",value:function(){e.exists=!1}}]),e}();function ge(e){return{type:"SET_SOCKET",socket:e}}var be=n(320),he=n(321),pe=n(106),Oe=n.n(pe),Ee=Object(z.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1},titleRoom:{flexGrow:1,marginLeft:40,borderWidth:1,borderColor:"#000"}}}));function je(e){var t=Ee(),n=Object(c.d)((function(e){return e.chatReducer.roomName}),c.b);return r.a.createElement("div",{className:t.root},r.a.createElement(be.a,{position:"static"},r.a.createElement(he.a,null,r.a.createElement(G.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(Oe.a,{onClick:e.showHideUsersList})),r.a.createElement(E.a,{variant:"h6",className:t.title,style:{color:e.colorNickName}},e.username),"default"!==n?r.a.createElement(E.a,{variant:"h6",className:t.titleRoom,style:{color:e.colorNickName}},n):null,r.a.createElement(j.a,{onClick:e.logout,color:"inherit"},"Logout"))))}n(3);var ve=n(22),ke=n(324),xe=n(322),ye=n(161),Ce=n.n(ye),we=n(162),Se=n.n(we),Ne=Object(z.a)((function(e){return{root:{display:"flex"},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - ".concat(240,"px)"),marginLeft:240,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:e.spacing(2)},hide:{display:"none"},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},drawerHeader:Object(l.a)(Object(l.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-end"}),content:{flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:-240},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0}}})),Re=function(e){var t=e.showRoomsContainer,n=e.setShowRoomsContainer,a=e.currentUserName,o=e.goToOneToOneRoome,i=Ne(),s=Object(ve.a)(),u=Object(c.d)((function(e){return e.chatReducer.rooms}),c.b);return r.a.createElement("div",{className:i.root},r.a.createElement(ke.a,{className:i.drawer,variant:"persistent",anchor:"left",open:t,classes:{paper:i.drawerPaper}},r.a.createElement("div",{className:i.drawerHeader},r.a.createElement(E.a,{variant:"h6",noWrap:!0},"Chat rooms"),r.a.createElement(G.a,{onClick:function(){n(!1)}},"ltr"===s.direction?r.a.createElement(Ce.a,null):r.a.createElement(Se.a,null))),r.a.createElement(xe.a,null),r.a.createElement(ae.a,null,u.map((function(e,t){return r.a.createElement(re.a,{button:!0,key:"room-".concat(t),onClick:function(){return t=e.users.find((function(e){return e.name!==a})).userId,void o(t);var t}},r.a.createElement(oe.a,{primary:e.roomName.replace(a,""),secondary:e.messages[e.messages.length-1].textMessage.substr(0,50)}))}))),r.a.createElement(xe.a,null)))},Me=Object(z.a)((function(e){var t;return{chatContainer:(t={background:"#6d81af",display:"flex",flexDirection:"row-reverse",margin:0,padding:0,height:800,position:"relative",maxHeight:1e3},Object(W.a)(t,e.breakpoints.down("xs"),{height:300,maxHeight:600}),Object(W.a)(t,e.breakpoints.down("sm"),{height:600,maxHeight:800}),t),chatList:{width:400}}})),Te=function(e){var t=Me(),n=V.a.get("userData"),o=n.nickNameColor,i=n.isAdmin,s=n.nickName,u=o,l=Object(a.useState)([]),m=Object(x.a)(l,2),d=m[0],f=m[1],g=Object(a.useState)(!1),b=Object(x.a)(g,2),h=b[0],p=b[1],O=Object(a.useState)(""),E=Object(x.a)(O,2),j=E[0],v=E[1],k=Object(a.useState)(!1),y=Object(x.a)(k,2),C=y[0],w=y[1],R=Object(a.useState)(!0),M=Object(x.a)(R,2),T=M[0],I=M[1],F=Object(a.useState)(!1),L=Object(x.a)(F,2),W=L[0],A=L[1],H=Object(c.c)(),_=Object(c.d)((function(e){return e.chatReducer.isConnected}),c.b),B=Object(c.d)((function(e){return e.chatReducer.users}),c.b),G=Object(c.d)((function(e){return e.chatReducer.socket}),c.b),P=Object(c.d)((function(e){return e.chatReducer.focusRoom}),c.b),q=Object(a.useCallback)((function(){return H(function(e){return Object(N.a)(S.a.mark((function t(){var n,a;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,localStorage.getItem("token");case 2:n=t.sent,(a=new fe(n).getSocket())&&e(ge(a));case 5:case"end":return t.stop()}}),t)})))}(H))}),[H]),z=Object(a.useCallback)((function(e){return H(function(e){return{type:"USERS",users:e}}(e))}),[H]),J=Object(a.useCallback)((function(e){return H(function(e){return{type:"ROOMS",rooms:e}}(e))}),[H]),$=Object(a.useCallback)((function(e){return H({type:"FOCUS_ROOM",roomName:e})}),[H]),Q=Object(a.useCallback)((function(e){return H(function(e){return{type:"IS_CONNECTED",isConnected:e}}(e))}),[H]),X=Object(a.useCallback)((function(e){return H(U(e))}),[H]),Z=Object(a.useCallback)((function(){G.disconnect(!0),ee()})),ee=Object(a.useCallback)((function(){V.a.clearAll(),X(!1),fe.changeExists(),e.history.push("/login")})),te=function(e){return G.emit("joinRoom",e)},ae=Object(a.useCallback)((function(e){return G.emit("chat",{textMessage:e,focusRoom:P})}));return Object(a.useEffect)((function(){return q(),G&&(G.on("users",(function(e){return z(e)})),G.on("previousMessages",(function(e){return f(e)})),G.on("error",(function(t){alert(t),e.history.push("/login")})),G.on("initialMuteStatus",(function(e){return w(e)})),G.on("rooms",(function(e){J(e)})),G.on("focusRoom",(function(e){$(e)})),G.on("mute",(function(e){return w(e)})),G.on("chat",(function(e){return f([].concat(Object(D.a)(d),[e]))})),G.on("disconnect",(function(e){ee()})),p(i),v(s),Q(!0)),function(){return Q(!1)}}),[B,G,d]),_&&B.length>0?r.a.createElement(Y.a,{style:{display:"flex",flexDirection:"column"}},r.a.createElement(je,{username:s,colorNickName:u,showHideUsersList:function(){return I(!T)},logout:function(){return Z()}}),r.a.createElement(Y.a,{className:t.chatContainer},r.a.createElement(ue,{users:B,isAdmin:h,userName:j,setMuteStatus:function(e){return t=e,G.emit("mute",t);var t},setBan:function(e){return t=e,G.emit("ban",t);var t},showUsersContainer:T,goToOneToOneRoome:te}),r.a.createElement(ne,{messages:d,username:s}),r.a.createElement(Re,{goToOneToOneRoome:te,showRoomsContainer:W,setShowRoomsContainer:A,currentUserName:j})),C?null:r.a.createElement(K,{handleSubmit:function(e){return ae(e)}})):null},Ie=n(89),Fe=n(88),Ve=function(e){Object(Ie.a)(n,e);var t=Object(Fe.a)(n);function n(e){var a;return Object(R.a)(this,n),(a=t.call(this,e)).state={},a}return Object(le.a)(n,[{key:"render",value:function(){return r.a.createElement(b.a,{to:"/login"})}}]),n}(a.Component),Le=n(60),Ue=function(e,t,n){e.meta.auth?(localStorage.getItem("token")&&n.redirect("/chat"),n.redirect("/login")):n()},We=n(164),Ae=function(e){Object(Ie.a)(n,e);var t=Object(Fe.a)(n);function n(e){var a;return Object(R.a)(this,n),(a=t.call(this,e)).state={loading:!0},a}return Object(le.a)(n,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(We.a,{color:"#123abc",loading:this.state.loading}))}}]),n}(r.a.Component),He=function(){return r.a.createElement("div",null,r.a.createElement("h3",null,"404 page not found"),r.a.createElement("p",null,"We are sorry but the page you are looking for does not exist."))},_e=function(){return r.a.createElement(Le.a,{guards:[Ue],loading:Ae,error:He},r.a.createElement(b.d,null,r.a.createElement(Le.b,{path:"/login",exact:!0,component:B,meta:{auth:!0}}),r.a.createElement(Le.b,{path:"/",exact:!0,component:Ve,meta:{auth:!0}}),r.a.createElement(Le.b,{path:"/chat",exact:!0,component:Te,meta:{auth:!0}}),r.a.createElement(Le.b,{path:"*",component:He})))},Be=n(31),De=Object(Be.a)(),Ge=g,Pe=function(){return r.a.createElement(c.a,{store:Ge},r.a.createElement(b.c,{history:De},r.a.createElement(_e,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Pe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[178,1,2]]]);
//# sourceMappingURL=main.77c42f6a.chunk.js.map