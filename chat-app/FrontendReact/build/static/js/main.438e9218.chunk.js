(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{148:function(e,t,n){e.exports=n(223)},153:function(e,t,n){},219:function(e,t){},223:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(8),o=n.n(i),s=(n(153),n(46)),c=n(40),u=n(128),l=n(16),m={onlineUsers:[],allUsers:[],isConnected:!1,socket:null,messages:[],isMuted:!1};var h={isLoggedIn:!1,allUsers:[],isConnected:!1,isFetching:!1};var d=Object(c.c)({chatReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ONLINE_USERS":return Object(l.a)(Object(l.a)({},e),{},{onlineUsers:t.onlineUsers});case"ALL_USERS":return Object(l.a)(Object(l.a)({},e),{},{allUsers:t.allUsers});case"IS_CONNECTED":return Object(l.a)(Object(l.a)({},e),{},{isConnected:t.isConnected});case"SET_SOCKET":return Object(l.a)(Object(l.a)({},e),{},{socket:t.socket});case"ALL_MESSAGES":case"IS_MUTED":return Object(l.a)(Object(l.a)({},e),{},{messages:t.messages});default:return e}},authReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IS_LOGGED_IN":return Object(l.a)(Object(l.a)({},e),{},{isLoggedIn:t.isLoggedIn});case"IS_FETCHING":return Object(l.a)(Object(l.a)({},e),{},{isFetching:t.isFetching});default:return e}}}),g=Object(c.d)(d,Object(c.a)(u.a)),p=n(271),f=n(10),b=n.n(f),v=n(19),k=n(18),y=n(22),x=n(27),E=n(26),O=n(272),S=n(135),w=n.n(S),j=n(72),C=n(12),M=n(229),N=n(20),I=n(258),T=function(e){Object(x.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(k.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t=e.target.value,n=e.target.name;a.setState(Object(C.a)({},n,t))},a.handleSubmit=function(){var e=Object.assign({id:null},a.state);a.reset(),a.props.handleSubmit(e)},a.state={username:"",password:""},a}return Object(y.a)(n,[{key:"componentDidMount",value:function(){N.ValidatorForm.addValidationRule("moreThanThreeChar",(function(e){return!(e.length<3)})),N.ValidatorForm.addValidationRule("notAllowedSpecialSymbols",(function(e){return!/[^A-z\u0410-\u044f\u0401\u04510-9)]/.test(e)}))}},{key:"componentWillUnmount",value:function(){N.ValidatorForm.removeValidationRule("moreThanThreeChar"),N.ValidatorForm.removeValidationRule("notAllowedSpecialSymbols")}},{key:"reset",value:function(){this.setState((function(e){return{username:"",password:""}}))}},{key:"render",value:function(){var e=this.state,t=e.username,n=e.password,a=this.props.isFetching;return r.a.createElement(N.ValidatorForm,{ref:"form",onSubmit:this.handleSubmit},r.a.createElement(N.TextValidator,{fullWidth:!0,label:"Username",onChange:this.handleChange,name:"username",value:t,validators:["required","moreThanThreeChar","notAllowedSpecialSymbols"],errorMessages:["this field is required","3 characters minimum","Not allowed special symbols"],margin:"normal"}),r.a.createElement(N.TextValidator,{fullWidth:!0,label:"Password",type:"password",onChange:this.handleChange,name:"password",value:n,validators:["required"],errorMessages:["this field is required"],margin:"normal"}),r.a.createElement(M.a,{variant:"contained",fullWidth:!0,color:"primary",type:"submit",disabled:a,margin:"normal"},a&&r.a.createElement(I.a,{size:20})," Save"))}}]),n}(a.Component),U=function e(){Object(k.a)(this,e)};U.loginUser=function(){var e=Object(v.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("http://localhost:3000/auth/login",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var L=function(e){return{type:"IS_LOGGED_IN",isLoggedIn:e}},R=function(e){return{type:"IS_FETCHING",isFetching:e}};var F=n(259),_=n(228),V=n(133),A=n.n(V)()((function(e){return{main:Object(C.a)({width:"auto",display:"block",marginLeft:3*e.spacing.unit,marginRight:3*e.spacing.unit},e.breakpoints.up(400+3*e.spacing.unit*2),{width:400,marginLeft:"auto",marginRight:"auto"}),paper:{marginTop:8*e.spacing.unit,display:"flex",flexDirection:"column",alignItems:"center",padding:"".concat(2*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px")},avatar:{margin:e.spacing.unit,backgroundColor:e.palette.secondary.main},text:{textAlign:"center"}}}))((function(e){var t=e.classes,n=e.children;return r.a.createElement("div",null,r.a.createElement("main",{className:t.main},r.a.createElement(F.a,null),r.a.createElement(_.a,{className:t.paper},n)),r.a.createElement("p",{className:t.text},"Build with ",r.a.createElement("span",{role:"img","aria-label":"Love"},"\u2764\ufe0f")," by the ",r.a.createElement("a",{href:"https://material-ui.com"},"Material-UI")))})),D=n(134),H=n.n(D);var W=["red","orange","yellow","purple","green"],B=function(e){Object(x.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(k.a)(this,n),(a=t.call(this,e)).state={didInvalidate:!1},a}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=Object(v.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.getItem("userToken");case 2:if(!e.sent){e.next=6;break}return window.location.href="/chat",e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(e){e.id;var t,n,a=e.username,r=e.password;this.setState((function(e){return{isFetching:!0,didInvalidate:!1}})),this.props.signIn({id:null,nickName:a,password:r,nickNameColor:H()({luminosity:"dark",hue:W[(t=0,n=5,t+Math.floor(Math.random()*(n-t+1)))]})}).catch((function(e){console.log(e)}))}},{key:"componentDidUpdate",value:function(e){e.isLoggedIn!=this.props.isLoggedIn&&this.props.isLoggedIn&&(window.location.href="/chat")}},{key:"render",value:function(){var e=this,t=this.props.isFetching;return r.a.createElement(A,null,r.a.createElement(O.a,null,r.a.createElement(w.a,null)),r.a.createElement(j.a,{component:"h1",variant:"h5"},"Sign in"),r.a.createElement(T,{handleSubmit:function(t){return e.login(t)},isFetching:t}))}}]),n}(a.Component);var G=Object(s.b)((function(e){return{isLoggedIn:e.authReducer.isLoggedIn,isFetching:e.authReducer.isFetching}}),(function(e){return{signIn:function(t){return e(function(e){return function(){var t=Object(v.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(R(!0));case 2:return t.next=4,U.loginUser(e).then(function(){var e=Object(v.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){if(500===e.status)n(R(!1)),alert(e.msg);else{if(!e.userToken||200!==e.status)throw new Error("Unknown error");localStorage.setItem("userToken",e.userToken),n(L(!0))}})).catch((function(e){alert(e.message),n(R(!1))}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t))}}}))(B),P=n(139),q=n(89),J=n.n(q),z=n(70),K=n.n(z),$=n(260),Q=n(136),X=n.n(Q),Y=function(e){Object(x.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(k.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t=e.target.value,n=e.target.name;a.setState(Object(C.a)({},n,t))},a.handleSubmit=function(){var e=localStorage.getItem("userToken"),t=K()(e),n={id:null,textMessage:a.state.message,authorMessage:t.nickName};a.reset(),a.props.handleSubmit(n)},a.state={message:""},a}return Object(y.a)(n,[{key:"componentDidMount",value:function(){N.ValidatorForm.addValidationRule("maxSymbols",(function(e){return!(e.length>200)}))}},{key:"componentWillUnmount",value:function(){N.ValidatorForm.removeValidationRule("maxSymbols")}},{key:"reset",value:function(){this.setState((function(e){return{message:""}}))}},{key:"render",value:function(){var e=this.state.message;return r.a.createElement(N.ValidatorForm,{ref:"form",onSubmit:this.handleSubmit,style:{display:"flex"}},r.a.createElement(N.TextValidator,{fullWidth:!0,label:"Message",onChange:this.handleChange,name:"message",value:e,validators:["required","maxSymbols"],errorMessages:["this field is required","maximum 200 symbols"],margin:"normal",style:{width:"50%"}}),r.a.createElement($.a,{"aria-label":"send",type:"submit"},r.a.createElement(X.a,null)))}}]),n}(a.Component),Z=n(264),ee=n(263),te=n(261),ne=n(262),ae=Object(te.a)((function(e){return{root:{display:"flex",marginTop:5,justifyContent:"flex-start"},myMsg:{display:"flex",marginTop:5,justifyContent:"flex-end"},rootPaper:{padding:e.spacing(1),maxWidth:200,borderRadius:20,backgroundColor:"#eaeaea"},myMsgPaper:{padding:e.spacing(1),maxWidth:200,borderRadius:20,backgroundColor:"#c1e2ce"},msgText:{margin:"auto",display:"block",maxHeight:"100%"}}}));function re(e){var t=e.timeMessage,n=e.authorMessage,a=e.textMessage,i=e.username,o=e.colorNickName,s=ae(i===n?"flex-end":"flex-start");return r.a.createElement("div",{className:i===n?s.myMsg:s.root},r.a.createElement(_.a,{className:i===n?s.myMsgPaper:s.rootPaper},r.a.createElement(ne.a,{item:!0,xs:!0,container:!0,direction:"column",className:i===n?s.myMsgPaper:s.rootPaper},r.a.createElement(ne.a,{item:!0,xs:!0},r.a.createElement(j.a,{variant:"subtitle2",style:{color:o}},n)),r.a.createElement(ne.a,{item:!0,xs:!0},r.a.createElement(j.a,{variant:"body1",style:{wordWrap:"break-word"}},a)),r.a.createElement(ne.a,{item:!0,xs:!0},r.a.createElement(j.a,{variant:"body2",color:"textSecondary"},t)))))}n(111);var ie=n(71),oe=n.n(ie),se=void 0,ce=Object(ee.a)(Z.a)({background:"inherit",display:"flex",flexDirection:"column",height:"inherit",maxHeight:"inherit"}),ue=function(e){var t=e.messages,n=e.username;return se._scrollRef.scrollTop=0,r.a.createElement(oe.a,{ref:function(e){se._scrollBarRef=e}},r.a.createElement(ce,null,t.map((function(e){return r.a.createElement(re,{timeMessage:J()(e.timeMessage).calendar(),authorMessage:e.authorMessage,textMessage:e.textMessage,username:n,colorNickName:e.colorAuthorName})}))))},le=n(257),me=n(266),he=n(267),de=n(265),ge=n(268),pe=Object(te.a)((function(e){var t;return{root:(t={width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper,position:"relative",height:"avalaible",maxHeight:"inherit",borderColor:"#000",borderWidth:2},Object(C.a)(t,"backgroundColor","#eabf7d8c"),Object(C.a)(t,"top",0),Object(C.a)(t,"left",0),Object(C.a)(t,"@media (max-height:600px)",{height:400,maxHeight:500}),t),ul:{backgroundColor:"#eabf7d8c",padding:0}}}));function fe(e){var t=this,n=e.isAdmin,a=e.users,i=e.userName,o=e.setMuteStatus,s=e.setBan,c=e.showUsersContainer,u=e.usersListMobile,l=pe(),m={Online:a.filter((function(e){return e.onlineStatus})),Offline:a.filter((function(e){return!e.onlineStatus}))},h=n?["Online","Offline"]:["Online"];return r.a.createElement(oe.a,{ref:function(e){t._scrollBarRef=e}},r.a.createElement(le.a,{className:l.root,subheader:r.a.createElement("li",null),style:c?Object.assign({display:"block"},u?{position:"absolute",backgroundColor:"#abd28c",height:300}:{position:"initial"}):{display:"none"}},h.map((function(e,t){return r.a.createElement("li",{key:"section-".concat(t),className:l.listSection},r.a.createElement("ul",{className:l.ul},r.a.createElement(de.a,null,"".concat(e)),m[e].map((function(e){return r.a.createElement(me.a,{key:"".concat(e.nickName)},r.a.createElement(he.a,{primary:"".concat(e.nickName),style:{color:e.nickNameColor}}),n&&e.nickName!==i?r.a.createElement(ge.a,{size:"small","aria-label":"small outlined button group"},r.a.createElement(M.a,{onClick:function(){return function(e){o(e)}(e)}}," ",e.isMuted?"unmute":"mute"),r.a.createElement(M.a,{onClick:function(){return function(e){s(e)}(e)}},e.isBaned?"unban":"ban")):null)}))))}))))}var be=n(137),ve=n.n(be),ke=function(){function e(t){if(Object(k.a)(this,e),e.exists)return e.instance;e.instance=this,e.exists=!0,this.socket=ve()("http://localhost:3000?token=".concat(t),{forceNew:!0})}return Object(y.a)(e,[{key:"getSocket",value:function(){return this.socket}}]),e}();function ye(e){return{type:"SET_SOCKET",socket:e}}var xe,Ee=n(269),Oe=n(270),Se=n(138),we=n.n(Se),je=Object(te.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function Ce(e){var t=je();return r.a.createElement("div",{className:t.root},r.a.createElement(Ee.a,{position:"static"},r.a.createElement(Oe.a,null,r.a.createElement($.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(we.a,{onClick:e.showHideUsersList})),r.a.createElement(j.a,{variant:"h6",className:t.title,style:{color:e.colorNickName}},e.username),r.a.createElement(M.a,{onClick:e.logout,color:"inherit"},"Logout"))))}var Me=Object(ee.a)(Z.a)((xe={background:"#6d81af",display:"flex",flexDirection:"row-reverse",margin:0,padding:0,height:815,position:"relative",maxHeight:1e3},Object(C.a)(xe,"@media (max-height:900px)",{height:715,maxHeight:900}),Object(C.a)(xe,"@media (max-height:800px)",{height:615,maxHeight:800}),Object(C.a)(xe,"@media (max-height:700px)",{height:515,maxHeight:700}),Object(C.a)(xe,"@media (max-height:600px)",{height:415,maxHeight:600}),Object(C.a)(xe,"@media (max-height:500px)",{height:315,maxHeight:500}),Object(C.a)(xe,"@media (max-height:400px)",{height:250,maxHeight:400}),xe)),Ne=function(e){Object(x.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(k.a)(this,n),(a=t.call(this,e)).colorNickName="white",a.state={messages:[],isAdmin:!1,currentUser:"",isMuted:!1,showUsersContainer:!0,usersListMobile:!1},a}return Object(y.a)(n,[{key:"componentWillUnmount",value:function(){this.props.isConnected(!1)}},{key:"componentDidMount",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t,n,a,r=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.getItem("userToken");case 2:if(t=e.sent){e.next=6;break}return window.location.href="/login",e.abrupt("return");case 6:return n=K()(t),window.matchMedia("(max-width: 400px)").addListener((function(e){r.setState({usersListMobile:e.matches}),e.matches&&r.setState({showUsersContainer:!1})})),e.next=10,this.props.initConnection();case 10:(a=this.props.socket).on("users",(function(e){r.props.setOnlineUsers(e)})),a.on("previousMessages",(function(e){return r.setState({messages:e})})),a.on("error",(function(e){alert(e.msg),window.location.href="/login"})),a.on("initialMuteStatus",(function(e){r.setState({isMuted:e})})),a.on("mute",(function(e){r.props.setIsMuteStatus(e),r.setState({isMuted:e})})),a.on("chat",(function(e){return r.setState({messages:[].concat(Object(P.a)(r.state.messages),[e])})})),a.on("disconnect",(function(e){localStorage.removeItem("userToken"),window.location.href="/login"})),this.colorNickName=n.nickNameColor,this.setState({isAdmin:n.isAdmin,currentUser:n.nickName}),this.props.isConnected(!0);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setMuteStatus",value:function(e){this.props.socket.emit("mute",e.id)}},{key:"setBan",value:function(e){this.props.socket.emit("ban",e.id)}},{key:"sendMsg",value:function(e){this.props.socket.emit("chat",JSON.stringify(e))}},{key:"logout",value:function(){var e=Object(v.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.removeItem("userToken");case 2:this.props.socket.disconnect(!0),window.location.href="/login";case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,n=t.isConnected,a=t.onlineUsers,i=this.state,o=i.isAdmin,s=i.currentUser,c=i.showUsersContainer,u=i.usersListMobile;return n&&a.length>0?r.a.createElement(Z.a,{style:{display:"flex",flexDirection:"column"}},r.a.createElement(Ce,{username:s,colorNickName:this.colorNickName,showHideUsersList:function(){return e.setState({showUsersContainer:!e.state.showUsersContainer})},logout:function(){return e.logout()}}),r.a.createElement(Me,null,r.a.createElement(fe,{users:a,isAdmin:o,userName:s,setMuteStatus:function(t){return e.setMuteStatus(t)},setBan:function(t){return e.setBan(t)},showUsersContainer:c,usersListMobile:u}),r.a.createElement(ue,{messages:this.state.messages,username:this.state.currentUser})),this.state.isMuted?null:r.a.createElement(Y,{handleSubmit:function(t){return e.sendMsg(t)}})):null}}]),n}(a.Component);var Ie=Object(s.b)((function(e){return{isConnected:e.chatReducer.isConnected,onlineUsers:e.chatReducer.onlineUsers,messages:e.chatReducer.messages,socket:e.chatReducer.socket,isMuted:e.chatReducer.isMuted}}),(function(e){return{initConnection:function(){return e(function(e){return Object(v.a)(b.a.mark((function t(){var n,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,localStorage.getItem("userToken");case 2:n=t.sent,(a=new ke(n).getSocket())&&e(ye(a));case 5:case"end":return t.stop()}}),t)})))}(e))},setOnlineUsers:function(t){return e(function(e){return{type:"ONLINE_USERS",onlineUsers:e}}(t))},isConnected:function(t){return e(function(e){return{type:"IS_CONNECTED",isConnected:e}}(t))},setIsMuteStatus:function(t){return e({type:"IS_MUTED",isMuted:t})},setIsLoggedIn:function(t){return e(L(t))}}}))(Ne),Te=function(e){Object(x.a)(n,e);var t=Object(E.a)(n);function n(e){var a;return Object(k.a)(this,n),(a=t.call(this,e)).state={userToken:null},a}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.getItem("userToken");case 2:(t=e.sent)?this.setState({userToken:t}):this.setState({userToken:"none"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"condRender",value:function(){return this.state.userToken&&"none"!==this.state.userToken?r.a.createElement(p.a,{to:"/chat"}):r.a.createElement(p.a,{to:"/login"})}},{key:"sendMessage",value:function(){}},{key:"sendMessageIfEnter",value:function(e){13===e.keyCode&&this.sendMessage()}},{key:"render",value:function(){return this.state.userToken?this.condRender():r.a.createElement("div",null,"Error loading page")}}]),n}(a.Component),Ue=function(){return r.a.createElement(p.d,null,r.a.createElement(p.b,{exact:!0,path:"/",component:Te}),r.a.createElement(p.b,{path:"/login",component:G}),r.a.createElement(p.b,{path:"/chat",component:Ie}))},Le=n(30),Re=Object(Le.a)(),Fe=g,_e=function(){return r.a.createElement(s.a,{store:Fe},r.a.createElement(p.c,{history:Re},r.a.createElement(Ue,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(_e,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[148,1,2]]]);
//# sourceMappingURL=main.438e9218.chunk.js.map