(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{149:function(e,t,n){e.exports=n(222)},154:function(e,t,n){},217:function(e,t){},222:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(8),i=n.n(s),o=(n(154),n(48)),c=n(40),u=n(130),l=n(15),m={onlineUsers:[],allUsers:[],isConnected:!1,socket:null,messages:[],isMuted:!1};var h={onlineUsers:[],allUsers:[],isConnected:!1};var p=Object(c.c)({chatReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ONLINE_USERS":return Object(l.a)(Object(l.a)({},e),{},{onlineUsers:t.onlineUsers});case"ALL_USERS":return Object(l.a)(Object(l.a)({},e),{},{allUsers:t.allUsers});case"IS_CONNECTED":return Object(l.a)(Object(l.a)({},e),{},{isConnected:t.isConnected});case"SET_SOCKET":return Object(l.a)(Object(l.a)({},e),{},{socket:t.socket});case"ALL_MESSAGES":case"IS_MUTED":return Object(l.a)(Object(l.a)({},e),{},{messages:t.messages});default:return e}},authReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ONLINE_USERS":return Object(l.a)(Object(l.a)({},e),{},{onlineUsers:t.onlineUsers});case"ALL_USERS":return Object(l.a)(Object(l.a)({},e),{},{allUsers:t.allUsers});case"IS_CONNECTED":return Object(l.a)(Object(l.a)({},e),{},{isConnected:t.isConnected});default:return e}}}),d=Object(c.d)(p,Object(c.a)(u.a)),f=n(11),g=n(18),b=n(22),v=n(28),k=n(27),E=n(45),O=n(271),S=n(137),y=n.n(S),j=n(76),x=n(75),w=n(228),M=n(35),N=n(258),C=function(e){Object(v.a)(t,e);Object(k.a)(t);function t(){return Object(g.a)(this,t),(void 0).state={username:"",password:""},Object(x.a)(void 0)}return Object(b.a)(t,[{key:"reset",value:function(){this.setState((function(e){return{username:"",password:""}}))}},{key:"render",value:function(){var e=this.state,t=e.username,n=e.password,a=this.props.isFetching;return r.a.createElement(M.ValidatorForm,{ref:"form",onSubmit:this.handleSubmit},r.a.createElement(M.TextValidator,{fullWidth:!0,label:"Username",onChange:this.handleChange,name:"username",value:t,validators:["required"],errorMessages:["this field is required"],margin:"normal"}),r.a.createElement(M.TextValidator,{fullWidth:!0,label:"Password",type:"password",onChange:this.handleChange,name:"password",value:n,validators:["required"],errorMessages:["this field is required"],margin:"normal"}),r.a.createElement(w.a,{variant:"contained",fullWidth:!0,color:"primary",type:"submit",disabled:a,margin:"normal"},a&&r.a.createElement(N.a,{size:20})," Save"))}}]),t}(a.Component),U=n(14),T=n.n(U),I=n(24),R=function e(){Object(g.a)(this,e)};R.loginUser=function(){var e=Object(I.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("http://localhost:3000/auth/login",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var L=n(47),_=n(259),A=n(227),B=n(135),D=n.n(B)()((function(e){return{main:Object(L.a)({width:"auto",display:"block",marginLeft:3*e.spacing.unit,marginRight:3*e.spacing.unit},e.breakpoints.up(400+3*e.spacing.unit*2),{width:400,marginLeft:"auto",marginRight:"auto"}),paper:{marginTop:8*e.spacing.unit,display:"flex",flexDirection:"column",alignItems:"center",padding:"".concat(2*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px ").concat(3*e.spacing.unit,"px")},avatar:{margin:e.spacing.unit,backgroundColor:e.palette.secondary.main},text:{textAlign:"center"}}}))((function(e){var t=e.classes,n=e.children;return r.a.createElement("div",null,r.a.createElement("main",{className:t.main},r.a.createElement(_.a,null),r.a.createElement(A.a,{className:t.paper},n)),r.a.createElement("p",{className:t.text},"Build with ",r.a.createElement("span",{role:"img","aria-label":"Love"},"\u2764\ufe0f")," by the ",r.a.createElement("a",{href:"https://material-ui.com"},"Material-UI")))})),W=n(136),F=n.n(W);var q=["red","orange","yellow","purple","green"],V=function(e){Object(v.a)(n,e);var t=Object(k.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).state={isFetching:!1,didInvalidate:!1},a}return Object(b.a)(n,[{key:"login",value:function(e){var t,n,a=this,r=(e.id,e.username),s=e.password;this.setState((function(e){return{isFetching:!0,didInvalidate:!1}})),this.props.signIn({id:null,nickName:r,password:s,nickNameColor:F()({hue:q[(t=0,n=5,t+Math.floor(Math.random()*(n-t+1)))]})}).then((function(e){console.log(e),localStorage.setItem("userToken",e.userToken),a.props.history.push("/chat")})).catch((function(e){a.setState((function(e){return{isFetching:!1,didInvalidate:!0}})),console.log(e)}))}},{key:"render",value:function(){var e=this,t=this.state.isFetching;return r.a.createElement(D,null,r.a.createElement(O.a,null,r.a.createElement(y.a,null)),r.a.createElement(j.a,{component:"h1",variant:"h5"},"Sign in"),r.a.createElement(C,{handleSubmit:function(t){return e.login(t)},isFetching:t}),r.a.createElement("p",null,"Need an account? ",r.a.createElement(E.a,{to:"/signup"},"Sign up")))}}]),n}(a.Component);var H=Object(o.b)((function(e){return{}}),(function(e){return{signIn:function(t){return e(function(e){return function(){R.loginUser(e).then((function(e){return console.log(e),e.json()})).catch((function(e){return console.log(e)}))}}(t))}}}))(V),J=n(97),G=n(66),z=n.n(G),K=function(){function e(t){if(Object(g.a)(this,e),e.exists)return e.instance;e.instance=this,e.exists=!0,this.socket=z()("http://localhost:3000?token=".concat(t),{forceNew:!0})}return Object(b.a)(e,[{key:"getSocket",value:function(){return this.socket}}]),e}(),P=n(67),Y=n.n(P),$=n(56),Q=n.n($),X=n(260),Z=n(138),ee=n.n(Z),te=function(e){Object(v.a)(n,e);var t=Object(k.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t=e.target.value,n=e.target.name;a.setState(Object(L.a)({},n,t))},a.handleSubmit=function(){var e=localStorage.getItem("userToken"),t=Q()(e);a.props.handleSubmit({id:null,textMessage:a.state.message,authorMessage:t.nickName}),a.reset()},a.state={message:""},a}return Object(b.a)(n,[{key:"reset",value:function(){this.setState((function(e){return{message:""}}))}},{key:"render",value:function(){var e=this.state.message;return r.a.createElement(M.ValidatorForm,{ref:"form",onSubmit:this.handleSubmit,style:{display:"flex"}},r.a.createElement(M.TextValidator,{fullWidth:!0,label:"Message",onChange:this.handleChange,name:"message",value:e,validators:["required"],errorMessages:["this field is required"],margin:"normal",style:{width:"50%"}}),r.a.createElement(X.a,{"aria-label":"send",type:"submit"},r.a.createElement(ee.a,null)))}}]),n}(a.Component),ne=n(264),ae=n(263),re=n(261),se=n(262),ie=Object(re.a)((function(e){return{root:{},paper:{padding:e.spacing(1),margin:"auto",maxWidth:200,borderRadius:20},msgText:{margin:"auto",display:"block",maxWidth:"100%",maxHeight:"100%"}}}));function oe(e){var t=ie(),n=e.timeMessage,a=e.authorMessage,s=e.textMessage;return r.a.createElement("div",{className:t.root},r.a.createElement(A.a,{className:t.paper},r.a.createElement(se.a,{container:!0,spacing:2},r.a.createElement(se.a,{item:!0,xs:12,sm:!0,container:!0},r.a.createElement(se.a,{item:!0,xs:!0,container:!0,direction:"column",spacing:2},r.a.createElement(se.a,{item:!0,xs:!0},r.a.createElement(j.a,{gutterBottom:!0,variant:"subtitle2"},a),r.a.createElement(j.a,{variant:"body1",gutterBottom:!0},s),r.a.createElement(j.a,{variant:"body2",color:"textSecondary"},n)))))))}var ce=Object(ae.a)(ne.a)({background:"#fff",display:"flex",flexDirection:"column",overflowY:"scroll",maxHeight:window.innerHeight-150}),ue=function(e){var t=e.messages,n=e.username;return r.a.createElement(ce,null,t.map((function(e){return r.a.createElement(se.a,{container:!0,justify:(t=e.authorMessage,a=n,t===a?"flex-end":"flex-start"),spacing:3},r.a.createElement(se.a,{item:!0},r.a.createElement(oe,{timeMessage:Y()(e.timeMessage).calendar(),authorMessage:e.authorMessage,textMessage:e.textMessage})));var t,a})))},le=n(257),me=n(266),he=n(267),pe=n(265),de=n(268),fe=Object(re.a)((function(e){return{root:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper,position:"relative",maxHeight:300,borderColor:"#000",borderWidth:2,overflowY:"scroll"},listSection:{backgroundColor:"inherit"},ul:{backgroundColor:"inherit",padding:0}}}));function ge(e){var t=e.isAdmin,n=e.users,a=e.userName,s=e.setMuteStatus,i=e.setBan,o=fe(),c={Online:n.filter((function(e){return e.onlineStatus})),Offline:n.filter((function(e){return!e.onlineStatus}))},u=t?["Online","Offline"]:["Online"];return r.a.createElement(le.a,{className:o.root,subheader:r.a.createElement("li",null)},u.map((function(e,n){return r.a.createElement("li",{key:"section-".concat(n),className:o.listSection},r.a.createElement("ul",{className:o.ul},r.a.createElement(pe.a,null,"".concat(e)),c[e].map((function(e){return r.a.createElement(me.a,{key:"".concat(e.nickName)},r.a.createElement(he.a,{primary:"".concat(e.nickName)}),t&&e.nickName!==a?r.a.createElement(de.a,{size:"small","aria-label":"small outlined button group"},r.a.createElement(w.a,{onClick:function(){return function(e){s(e)}(e)}}," ",e.isMuted?"unmute":"mute"),r.a.createElement(w.a,{onClick:function(){return function(e){i(e)}(e)}},e.isBaned?"unban":"ban")):null)}))))})))}function be(e){return{type:"SET_SOCKET",socket:e}}var ve=n(269),ke=n(270),Ee=n(139),Oe=n.n(Ee),Se=Object(re.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function ye(e){var t=Se();return r.a.createElement("div",{className:t.root},r.a.createElement(ve.a,{position:"static"},r.a.createElement(ke.a,null,r.a.createElement(X.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(Oe.a,null)),r.a.createElement(j.a,{variant:"h6",className:t.title,style:{color:e.colorNickName}},e.username),r.a.createElement(w.a,{onClick:e.logout,color:"inherit"},"Logout"))))}var je=Object(ae.a)(ne.a)({background:"#fff",display:"flex",flexDirection:"row-reverse"}),xe=function(e){Object(v.a)(n,e);var t=Object(k.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).colorNickName="white",a.handleNewUserMessage=function(e){console.log("New message incomig! ".concat(e))},a.state={messages:[],isAdmin:!1,currentUser:"",isMuted:!1},a}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=Object(I.a)(T.a.mark((function e(){var t,n,a=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.getItem("userToken");case 2:if(t=e.sent){e.next=6;break}return this.props.history.push("/login"),e.abrupt("return");case 6:return e.next=8,this.props.initConnection();case 8:this.props.socket.on("onlineUsers",(function(e){return a.props.setOnlineUsers(e)})),this.props.socket.on("users",(function(e){a.props.setOnlineUsers(e)})),this.props.socket.on("previousMessages",(function(e){return a.setState({messages:e})})),this.props.socket.on("initialMuteStatus",(function(e){return a.props.setIsMuteStatus(e)})),this.props.socket.on("mute",(function(e){console.log(e),a.props.setIsMuteStatus(e),a.setState({isMuted:e})})),this.props.socket.on("chat",(function(e){return a.setState({messages:[].concat(Object(J.a)(a.state.messages),[e])})})),this.props.socket.on("connection",(function(e){a.props.socket.on("disconnect",(function(e){localStorage.removeItem("userToken"),a.props.history.push("/login")}))})),this.props.socket.on("disconnect",(function(e){localStorage.removeItem("userToken"),a.props.history.push("/login")})),this.props.socket.on("disconnected",(function(e){})),n=Q()(t),this.colorNickName=n.nickNameColor,this.setState({isAdmin:n.isAdmin,currentUser:n.nickName}),this.props.isConnected(!0);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setMuteStatus",value:function(){var e=Object(I.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.socket.emit("mute",t.id);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setBan",value:function(){var e=Object(I.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.socket.emit("ban",t.id);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMsg",value:function(){var e=Object(I.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({messages:[].concat(Object(J.a)(this.state.messages),[t])}),this.props.socket.emit("chat",JSON.stringify(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(I.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.removeItem("userToken");case 2:this.props.socket.disconnect(!0),this.props.history.push("/login");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,n=t.isConnected,a=t.onlineUsers,s=this.state,i=s.isAdmin,o=s.currentUser;return n&&a.length>0?r.a.createElement(ne.a,{style:{display:"flex",flexDirection:"column"}},r.a.createElement(ye,{username:o,colorNickName:this.colorNickName,logout:function(){return e.logout()}}),r.a.createElement(je,null,r.a.createElement(ge,{users:a,isAdmin:i,userName:o,setMuteStatus:function(t){return e.setMuteStatus(t)},setBan:function(t){return e.setBan(t)}}),r.a.createElement(ue,{messages:this.state.messages})),this.state.isMuted?null:r.a.createElement(te,{handleSubmit:function(t){return e.sendMsg(t)}})):null}}]),n}(a.Component);var we=Object(o.b)((function(e){return{isConnected:e.chatReducer.isConnected,onlineUsers:e.chatReducer.onlineUsers,messages:e.chatReducer.messages,socket:e.chatReducer.socket,isMuted:e.chatReducer.isMuted}}),(function(e){return{initConnection:function(){return e(function(e){return Object(I.a)(T.a.mark((function t(){var n,a;return T.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,localStorage.getItem("userToken");case 2:n=t.sent,(a=new K(n).getSocket())&&e(be(a));case 5:case"end":return t.stop()}}),t)})))}(e))},setOnlineUsers:function(t){return e(function(e){return{type:"ONLINE_USERS",onlineUsers:e}}(t))},isConnected:function(t){return e(function(e){return{type:"IS_CONNECTED",isConnected:e}}(t))},setIsMuteStatus:function(t){return e({type:"IS_MUTED",isMuted:t})}}}))(xe),Me=function(e){Object(v.a)(n,e);var t=Object(k.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).state={userToken:null},a}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=Object(I.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,localStorage.getItem("userToken");case 2:(t=e.sent)?this.setState({userToken:t}):this.setState({userToken:"none"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"condRender",value:function(){return this.state.userToken,r.a.createElement(f.a,{to:"/login"})}},{key:"sendMessage",value:function(){}},{key:"sendMessageIfEnter",value:function(e){13===e.keyCode&&this.sendMessage()}},{key:"render",value:function(){this.sendMessage.bind(this),this.sendMessageIfEnter.bind(this);return this.state.userToken?this.condRender():null}}]),n}(a.Component),Ne=function(){return r.a.createElement(f.d,null,r.a.createElement(f.b,{exact:!0,path:"/",component:Me}),r.a.createElement(f.b,{path:"/login",component:H}),r.a.createElement(f.b,{path:"/chat",component:we}))},Ce=n(19),Ue=Object(Ce.a)(),Te=d,Ie=function(){return r.a.createElement(o.a,{store:Te},r.a.createElement(f.c,{history:Ue},r.a.createElement(Ne,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Ie,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[149,1,2]]]);
//# sourceMappingURL=main.fdaeb004.chunk.js.map